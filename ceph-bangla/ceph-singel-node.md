# ЁЯРШ Cephadm ржжрж┐ржпрж╝рзЗ Single Node Ceph Cluster ржЗржирзНрж╕ржЯрж▓рзЗрж╢ржи ржЧрж╛ржЗржб (Ubuntu 24.04 + Docker)

> **ржЕржлрж┐рж╢рж┐ржпрж╝рж╛рж▓ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржлрж▓рзЛ ржХрж░рзЗ рждрзИрж░рж┐:** https://docs.ceph.com/en/latest/cephadm/install/

**ржЖржорж╛рж░ ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ:**
| ржЖржЗржЯрзЗржо | ржнрзНржпрж╛рж▓рзБ |
|--------|--------|
| OS | Ubuntu 24.04.3 LTS |
| Hostname | `ceph1` |
| FQDN | `ceph1.paulco.com` |
| IP Address | `192.168.68.180` |
| Container Runtime | **Docker** |
| OS Disk | `/dev/sda` (200GB, Only OS) |
| OSD Disk | `/dev/sdb` (200GB, Unpartitioned) |

---

## ЁЯУЛ ржзрж╛ржк рзз: ржкрзНрж░рж┐-рж░рж┐ржХрзЛржпрж╝рж╛рж░ржорзЗржирзНржЯрж╕ рж╕рзЗржЯржЖржк

ржкрзНрж░ржержорзЗ SSH, Docker, LVM2 ржПржмржВ ржЯрж╛ржЗржо рж╕рж┐ржЩрзНржХ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред

#### рзз. рж╕рж┐рж╕рзНржЯрзЗржо ржЖржкржбрзЗржЯ ржУ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y ssh openssh-server lvm2 chrony curl jq
```
#### рзи. SSH рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ ржУ ржПржирж╛ржмрж▓ ржХрж░рзБржи (cephadm ржПрж░ ржЬржирзНржп mandatory)
```
sudo systemctl enable --now ssh
```
#### рзй. Docker ржЗржирзНрж╕ржЯрж▓ (ржпржжрж┐ ржЖржЧрзЗ ржерзЗржХрзЗ ржирж╛ ржерж╛ржХрзЗ)
#### Ubuntu 24.04 ржПрж░ ржЬржирзНржп ржЕржлрж┐рж╢рж┐ржпрж╝рж╛рж▓ Docker repo ржерзЗржХрзЗ ржЗржирзНрж╕ржЯрж▓ ржХрж░рж╛ ржирж┐рж░рж╛ржкржж
```
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
sudo systemctl enable --now docker
```
#### рзк. Time Synchronization ржЪрж╛рж▓рзБ ржХрж░рзБржи
```
sudo systemctl enable --now chrony
chronyc sources
```
> ржЪрзЗржХ ржХрж░рзБржи рж╕ржоржпрж╝ рж╕рж┐ржЩрзНржХ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛

#### рзл. Hostname ржУ FQDN рж╕рзЗржЯ ржХрж░рзБржи
```
sudo hostnamectl set-hostname ceph1
echo "192.168.68.180 ceph1.paulco.com ceph1" | sudo tee -a /etc/hosts
```
#### рзм. Root SSH Key ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзБржи (passwordless SSH ржПрж░ ржЬржирзНржп)
```
sudo ssh-keygen -t rsa -N "" -f /root/.ssh/id_rsa
sudo cp /root/.ssh/id_rsa.pub /root/.ssh/authorized_keys
sudo chmod 600 /root/.ssh/authorized_keys
```

---

## ЁЯУж ржзрж╛ржк рзи: `cephadm` ржЗржирзНрж╕ржЯрж▓рзЗрж╢ржи (Official Method)

`cephadm` ржЗржирзНрж╕ржЯрж▓ ржХрж░рж╛рж░ ржЬржирзНржп ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржжрзБржЯрж┐ ржкржжрзНржзрждрж┐ ржЖржЫрзЗред ржЖржкржирж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржЕржирзБржпрж╛ржпрж╝рзА ржпрзЗржХрзЛржирзЛ ржПржХржЯрж┐ ржмрзЗржЫрзЗ ржирж┐ржиред

---

### **ржкржжрзНржзрждрж┐ рзз: APT рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ (Ubuntu ржбрж┐ржлрж▓рзНржЯ)**

**ржЙржжрзНржжрзЗрж╢рзНржп:** ржжрзНрж░рзБржд рж╕рзЗржЯржЖржкрзЗрж░ ржЬржирзНржп ржпржЦржи Ubuntu ржПрж░ ржбрж┐ржлрж▓рзНржЯ ржнрж╛рж░рзНрж╕ржи ржЧрзНрж░рж╣ржгржпрзЛржЧрзНржпред

**тЪая╕П рж╕рзАржорж╛ржмржжрзНржзрждрж╛:** ржПржЯрж┐ ржЖржкржирж╛рж░ Ubuntu ржнрж╛рж░рзНрж╕ржирзЗрж░ рж╕рж╛ржерзЗ ржмрж╛ржгрзНржбрж┐рж▓ ржХрж░рж╛ Ceph ржнрж╛рж░рзНрж╕ржиржЯрж┐ ржЗржирзНрж╕ржЯрж▓ ржХрж░ржмрзЗ (ржпрзЗржоржи: Ubuntu 24.04 рждрзЗ Ceph Squid v19 ржЖрж╕рзЗ)ред ржЖржкржирж┐ рж╕рж╣ржЬрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрзЛржирзЛ ржкрзБрж░ржирзЛ ржмрж╛ LTS ржнрж╛рж░рзНрж╕ржи (ржпрзЗржоржи Reef v18) ржмрзЗржЫрзЗ ржирж┐рждрзЗ ржкрж╛рж░ржмрзЗржи ржирж╛ред

#### рзз. Ubuntu рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржерзЗржХрзЗ cephadm ржЗржирзНрж╕ржЯрж▓ ржХрж░рзБржи
```bash
sudo apt update
sudo apt install -y cephadm
```
#### рзи. ржЗржирзНрж╕ржЯрж▓рзЗрж╢ржи ржкрж╛рже ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи
```
which cephadm
```
> *ржЖржЙржЯржкрзБржЯ ржЖрж╕ржмрзЗ:* /usr/sbin/cephadm

#### рзй. ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ ржХрж░рзБржи

```
cephadm version
```
> ржирзЛржЯ: ржХрж┐ржЫрзБ Ubuntu ржкрзНржпрж╛ржХрзЗржЬрзЗ ржПржЯрж┐ 'UNKNOWN' ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рзЗ, рж╕ржарж┐ржХ ржнрж╛рж░рзНрж╕ржи ржжрзЗржЦрждрзЗ:

```
dpkg -l | grep cephadm
```

---

### **ржкржжрзНржзрждрж┐ рзи: `curl` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржнрж╛рж░рзНрж╕ржи ржЗржирзНрж╕ржЯрж▓ (ржкрзНрж░ржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп рж░рж┐ржХржорзЗржирзНржбрзЗржб)**

**ржЙржжрзНржжрзЗрж╢рзНржп:** ржкрзНрж░ржбрж╛ржХрж╢ржи ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржпрзЗржЦрж╛ржирзЗ OS ржнрж╛рж░рзНрж╕ржи ржирж┐рж░рзНржмрж┐рж╢рзЗрж╖рзЗ ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ Ceph ржнрж╛рж░рзНрж╕ржи (ржпрзЗржоржи Reef v18 LTS) ржкрзНрж░ржпрж╝рзЛржЬржиред

**тЬЕ рж╕рзБржмрж┐ржзрж╛:** Ceph рж░рж┐рж▓рж┐ржЬрзЗрж░ ржЙржкрж░ ржкрзВрж░рзНржг ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржерж╛ржХрзЗред

**ЁЯФН рж╕ржарж┐ржХ ржбрж╛ржЙржирж▓рзЛржб рж▓рж┐ржВржХ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж╛рж░ ржирж┐ржпрж╝ржо:**

рзз. **[https://download.ceph.com/](https://download.ceph.com/)** ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯрзЗ ржпрж╛ржиред

рзи. `ржЖржкржирж╛рж░ ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА ceph version` ржЦрзБржБржЬрзБржи (ржпрзЗржоржи: `rpm-reef`, `rpm-squid`, `rpm-quincy`)ред
   * `reef` = Ceph v18 (LTS - ржкрзНрж░ржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп рж╕рзЗрж░рж╛)
   * `squid` = Ceph v19 (рж▓рзЗржЯрзЗрж╕рзНржЯ)
   * `quincy` = Ceph v17 (ржкрзБрж░ржирзЛ LTS)

рзй. ржПрж░ржкрж░ ржХрзНрж░ржорж╛ржирзНржмржпрж╝рзЗ `ржирж┐рж░рзНржжрж┐рж╖рзНржЯ version` ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржпрж╛ржи ржПржмржВ `el9` ржлрж╛ржЗрж▓ржЯрж┐рждрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи рждрж╛рж░ржкрж░рзЗ `noarch` ржХрзНрж▓рж┐ржХ ржХрж░рзБржи ржПржмржВ `cephadm` ржлрж╛ржЗрж▓ржЯрж┐рж░ рж▓рж┐ржВржХ ржХржкрж┐ ржХрж░рзБржиред

рзк. рж▓рж┐ржВржХржЯрж┐ ржХржкрж┐ ржХрж░рждрзЗ (`cephadm` ржлрж╛ржЗрж▓ржЯрж┐рж░ ржЙржкрж░рзЗ > Right-click > Copy Link Address)ред рж▓рж┐ржВржХржЯрж┐ ржПржоржи ржжрзЗржЦрж╛ржмрзЗ:
- `https://download.ceph.com/rpm-squid/el9/noarch/cephadm`

рзл. ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбрзЗрж░ URL ржЯрж┐ ржЖржкржирж╛рж░ ржХржкрж┐ ржХрж░рж╛ рж▓рж┐ржВржХ ржжрж┐ржпрж╝рзЗ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи ржЕржержмрж╛ `CEPH_RELEASE` ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржарж┐ржХ рж░рзЗржЦрзЗ ржХржорж╛ржирзНржбржЯрж┐ рж░рж╛ржи ржХрж░рзБржиред

#### рзз. ржЖржкржирж╛рж░ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд рж░рж┐рж▓рж┐ржЬ ржирж╛ржо рж▓рж┐ржЦрзБржи (ржпрзЗржоржи: reef, squid, quincy)

```bash
CEPH_RELEASE=squid
```
#### рзи. ржирж┐рж░рзНржжрж┐рж╖рзНржЯ cephadm ржмрж╛ржЗржирж╛рж░рж┐ржЯрж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи
#### ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржУржпрж╝рзЗржмрж╕рж╛ржЗржЯ ржерзЗржХрзЗ ржкрж╛ржУржпрж╝рж╛ рж▓рж┐ржВржХржЯрж┐ ржирж┐ржЪрзЗ ржкрзЗрж╕рзНржЯ ржХрж░рзЗржУ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи
```
curl --silent --remote-name --location https://download.ceph.com/rpm-${CEPH_RELEASE}/el9/noarch/cephadm
```

#### рзй. ржлрж╛ржЗрж▓ржЯрж┐ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯрзЗржмрж▓ ржмрж╛ рж░рж╛ржиржпрзЛржЧрзНржп ржХрж░рзБржи
```
chmod +x cephadm
```
#### рзк. рж╕рж┐рж╕рзНржЯрзЗржо ржкрж╛ржерзЗ ржорзБржн ржХрж░рзБржи
```
sudo mv cephadm /usr/sbin/cephadm
```
#### рзл. ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржнрж╛рж░рзНрж╕ржиржЯрж┐ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рзБржи
```
cephadm version
```
> ржЖрж╢рж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржЖржЙржЯржкрзБржЯ ржЖрж╕ржмрзЗ: cephadm version 19.2.x ... squid (stable)

---

## ЁЯЪА ржзрж╛ржк рзй: ржирждрзБржи Ceph Cluster Bootstrap ржХрж░рж╛

ржПржЦржи ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк ржХрж░ржмрзЛред ржпрзЗрж╣рзЗрждрзБ ржЖржорж┐ **Docker** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржи ржПржмржВ ржПржЯрж┐ **Single Node**, рждрж╛ржЗ ржирж┐ржЪрзЗрж░ ржлрзНрж▓рзНржпрж╛ржЧржЧрзБрж▓рзЛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг:

* `--mon-ip 192.168.68.180`: ржоржирж┐ржЯрж░ рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ IP
* `--single-host-defaults`: рж╕рж┐ржЩрзНржЧрзЗрж▓ ржирзЛржбрзЗрж░ ржЬржирзНржп CRUSH рж░рзБрж▓рж╕ ржЕржЯрзЛ-ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░рзЗ (replica=2, failure-domain=host)
* `--container-engine docker`: ржкржбржорзНржпрж╛ржирзЗрж░ ржмржжрж▓рзЗ ржбржХрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп
* `--initial-dashboard-user`: `admin` ржЖржкржирж╛рж░ ржЗржЙржЬрж╛рж░ ржирзЗржо рж╕рзЗржЯ ржХрж░рзБржи 
* `--initial-dashboard-password`: `admin123` ржЗржЙржЬрж╛рж░рзЗрж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕рзЗржЯ ржХрж░рзБржи   

#### ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк ржХржорж╛ржирзНржб
```bash
sudo cephadm bootstrap \
  --mon-ip 192.168.68.180 \
  --single-host-defaults \
  --container-engine docker  \
  --initial-dashboard-user admin \
  --initial-dashboard-password admin123
```

тЬЕ **ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржпрж╛ ржХрж░ржмрзЗ:**
1. ржкрзНрж░ржержо Monitor ржУ Manager ржбрж┐ржоржи ржХржирзНржЯрзЗржЗржирж╛рж░ ржЪрж╛рж▓рзБ ржХрж░ржмрзЗ
2. `/etc/ceph/ceph.conf` ржПржмржВ `ceph.client.admin.keyring` ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░ржмрзЗ
3. SSH ржХрзА ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ рж╕рзЗржЯржЖржк ржХрж░ржмрзЗ
4. Dashboard, Prometheus, Grafana рж╕рж╣ ржмрзЗрж╕рж┐ржХ рж╕рж╛рж░рзНржнрж┐рж╕ ржбрж┐ржкрзНрж▓ржпрж╝ ржХрж░ржмрзЗ

ЁЯХР **рж╕ржоржпрж╝:** ржкрзНрж░ржержоржмрж╛рж░ рж░рж╛ржи ржХрж░рж▓рзЗ ржЗржорзЗржЬ ржкрзБрж▓ ржХрж░рждрзЗ рзи-рзл ржорж┐ржирж┐ржЯ рж╕ржоржпрж╝ ржирж┐рждрзЗ ржкрж╛рж░рзЗред

---

## ЁЯФз ржзрж╛ржк рзк: ржХржорж╛ржирзНржб рж▓рж╛ржЗржи ржерзЗржХрзЗ Ceph Cluster ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛

Cephadm ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ рж╣рзЛрж╕рзНржЯрзЗ `ceph` ржХржорж╛ржирзНржб ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗ ржирж╛ред ржХржорж╛ржирзНржб рж░рж╛ржи ржХрж░рж╛рж░ ржЬржирзНржп `cephadm shell` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ржЗ ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ред

#### тЬЕ  рзз ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ ржХрж░рзБржи
```
sudo cephadm shell -- ceph -s
```
#### тЬЕ  рзи рж╕ржарж┐ржХ ржнрж╛рж░рзНрж╕ржи ржХржиржлрж╛рж░рзНржо ржХрж░рзБржи
```
sudo cephadm shell -- ceph -v
```
> Expected: ceph version 18.2.7 (...) reef (stable)

#### тЬЕ  рзй ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржПржХрзНрж╕рзЗрж╕ ржЪрзЗржХ
```
sudo cephadm shell -- ceph mgr services
```
> Output: {"dashboard": "https://ceph2:8443/"}

#### тЬЕ рзк. ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж╣рзЗрж▓рже
sudo cephadm shell -- ceph health detail

#### тЬЕ рзл. рж╕рж╛рж░рзНржнрж┐рж╕ рж▓рж┐рж╕рзНржЯ
sudo cephadm shell -- ceph orch ls

#### тЬЕ рзм. рж╣рзЛрж╕рзНржЯ рж▓рж┐рж╕рзНржЯ
sudo cephadm shell -- ceph orch host ls

#### тЬЕ рзн. ржнрж╛рж░рзНрж╕ржи ржорзНржпрж╛ржЯрзНрж░рж┐ржХрзНрж╕
sudo cephadm shell -- ceph versions

#### тЬЕ рзо. ржЕрж░рзНржХрзЗрж╕рзНржЯрзНрж░рзЗржЯрж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕
sudo cephadm shell -- ceph orch status

#### тЬЕ рзп. ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржХржиржлрж┐ржЧ
sudo cephadm shell -- ceph config dump | grep network

---

### ржЕржержмрж╛ - ржЗржирзНржЯрж╛рж░рзЗржХрзНржЯрж┐ржн рж╢рзЗрж▓рзЗ ржврзБржХрзБржи
```
sudo cephadm shell
```
#### ржПржЦржи ржнрзЗрждрж░рзЗ рж╕рж░рж╛рж╕рж░рж┐ ceph ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЗржи
```
ceph status
```
#### ржПржмржВ ржЗржирзНржЯрж╛рж░рзЗржХрзНржЯрж┐ржн cephadm shell ржерзЗржХрзЗ ржмрж╛рж╣рж┐рж░ рж╣ржУрзЯрж╛рж░ ржЬржирзНржпржГ 
```
exit
```
---

### ceph-common ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж▓рзЗ рж╣рзЛрж╕рзНржЯ ржерзЗржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ ceph ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЗржи
```
sudo cephadm install ceph-common
```
#### ржЕржержмрж╛
```
sudo apt install -y ceph-common
```
> ржПржЦржи ржЖрж░ ржЗржирзНржЯрж╛рж░рзЗржХрзНржЯрж┐ржн рж╢рзЗрж▓рзЗ Open ржирж╛ ржХрж░рзЗржЗ рж╕рж░рж╛рж╕рж░рж┐ ceph ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЛ
#### ceph-common ржкрзНржпрж╛ржХрзЗржЬ ржЪрзЗржХ ржХрж░рж╛
```
dpkg -l | grep ceph-common 
```
#### # Ceph ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ ржХрж░рж╛
```
ceph -v
```

---

## ЁЯТ╛ ржзрж╛ржк рзл: `/dev/sdb` ржбрж┐рж╕рзНржХ ржжрж┐ржпрж╝рзЗ OSD ржЕрзНржпрж╛ржб ржХрж░рж╛


#### тЪая╕П ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирзЛржЯ: `/dev/sdb` ржбрж┐рж╕рзНржХ ржкрзНрж░рж╕рзНрждрзБрждрж┐ рж╕ржорзНржкрж░рзНржХрзЗ

> **ржкрзНрж░рж╢рзНржи:** *"ржПржЗ ржбрж┐рж╕рзНржХржЯрж┐ ржЖржорж┐ ржХрзЛржирзЛ ржкрж╛рж░рзНржЯрж╢ржи ржХрж░рж┐ ржирж╛ржЗ, ржПржЯрж╛ ржХрж┐ OSD рж╣рж┐рж╕рж╛ржмрзЗ ржЕрзНржпрж╛ржб ржХрж░рждрзЗ рж╣рж▓рзЗ ржбрж┐рж╕рзНржХржЯрж┐рждрзЗ ржЖржЧрзЗ ржХрзЛржирзЛ ржХрж╛ржЬ ржХрж░рждрзЗ рж╣ржмрзЗ?"*

**ржЙрждрзНрждрж░: тЭМ ржирж╛, ржХрзЛржирзЛ ржкрж╛рж░рзНржЯрж┐рж╢ржи ржмрж╛ ржлрж░ржорзНржпрж╛ржЯ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред**

Cephadm ржПржмржВ `ceph-volume` рж╕рж░рж╛рж╕рж░рж┐ **Raw Disk** (`/dev/sdb`) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржмрж░ржВ, ржбрж┐рж╕рзНржХржЯрж┐ ржпржжрж┐ ржЖржЧрзЗ ржерзЗржХрзЗ ржкрж╛рж░рзНржЯрж┐рж╢ржи ржХрж░рж╛, LVM ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛, ржмрж╛ ржлрж╛ржЗрж▓рж╕рж┐рж╕рзНржЯрзЗржо (ext4/xfs) ржжрж┐ржпрж╝рзЗ ржлрж░ржорзНржпрж╛ржЯ ржХрж░рж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ Ceph рж╕рзЗржЯрж┐ OSD рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ **рж░рж╛ржЬрж┐ рж╣ржмрзЗ ржирж╛**ред

тЬЕ **ржХрж┐ржЫрзБржЗ ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛:**  ржбрж┐рж╕рзНржХржЯрж┐ ржпрзЗржоржи ржЖржЫрзЗ (ржЦрж╛рж▓рж┐/raw), рждрзЗржоржиржЗ рж░рж╛ржЦрзБржиред Cephadm ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐:
1. ржбрж┐рж╕рзНржХржЯрж┐ ржбрж┐ржЯрзЗржХрзНржЯ ржХрж░ржмрзЗ
2. ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ LVM ржнрж▓рж┐ржЙржо рждрзИрж░рж┐ ржХрж░ржмрзЗ
3. BlueStore ржлрж░ржорзНржпрж╛ржЯрзЗ ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░ржмрзЗ
4. OSD рж╣рж┐рж╕рзЗржмрзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ ржЕрзНржпрж╛ржб ржХрж░ржмрзЗ

---

ржПржЦржи ржЖржкржирж╛рж░ 100GB ржбрж┐рж╕рзНржХржЯрж┐ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ ржЕрзНржпрж╛ржб ржХрж░ржмрзЛред

### рзл.рзз: ржбрж┐рж╕рзНржХ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи
ржкрзНрж░ржержорзЗ ржЪрзЗржХ ржХрж░рзБржи Ceph ржбрж┐рж╕рзНржХржЯрж┐ "Available" рж╣рж┐рж╕рзЗржмрзЗ ржжрзЗржЦрждрзЗ ржкрж╛ржЪрзНржЫрзЗ ржХрж┐ржирж╛:

```bash
sudo cephadm shell -- ceph orch device ls
```

**ржЖржЙржЯржкрзБржЯрзЗ ржпрж╛ ржжрзЗржЦржмрзЗржи:**
```
Hostname  Path      Type  Size   Available  Reject reasons
ceph1     /dev/sdb  hdd   100G   Yes        -
```
> тЬЕ ржпржжрж┐ `Available` ржХрж▓рж╛ржорзЗ `Yes` ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржбрж┐рж╕рзНржХржЯрж┐ OSD ржПрж░ ржЬржирзНржп рж░рзЗржбрж┐ред

### рзл.рзи: OSD ржбрж┐ржкрзНрж▓ржпрж╝ ржХрж░рж╛

```bash
# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржбрж┐рж╕рзНржХ ржжрж┐ржпрж╝рзЗ OSD рждрзИрж░рж┐
sudo cephadm shell -- ceph orch daemon add osd ceph1:/dev/sdb
```

### рзл.рзй: OSD рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ ржХрж░рж╛

```bash
# OSD рж▓рж┐рж╕рзНржЯ ржЪрзЗржХ ржХрж░рзБржи
sudo cephadm shell -- ceph osd tree

# ржЕржержмрж╛
sudo cephadm shell -- ceph orch ps --daemon-type osd
```

тЬЕ рж╕ржлрж▓ рж╣рж▓рзЗ ржЖржЙржЯржкрзБржЯрзЗ `ceph1` рж╣рзЛрж╕рзНржЯрзЗ `osd.0` (ржмрж╛ ржЕржирзНржп ID) рж░рж╛ржирж┐ржВ ржЕржмрж╕рзНржерж╛ржпрж╝ ржжрзЗржЦрж╛ржмрзЗред

---

## ЁЯзк ржзрж╛ржк рзм: ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи ржУ ржЯрзЗрж╕рзНржЯ

```bash
# рзз. ржкрзБрж░рзЛ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж╣рзЗрж▓рже ржЪрзЗржХ
sudo cephadm shell -- ceph -s

# рзи. ржбрж┐рж╕рзНржХ рж╕рзНржкрзЗрж╕ ржЪрзЗржХ
sudo cephadm shell -- ceph df

# рзй. ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯ RBD ржЗржорзЗржЬ рждрзИрж░рж┐ ржУ ржорж╛ржЙржирзНржЯ ржЯрзЗрж╕рзНржЯ (ржРржЪрзНржЫрж┐ржХ)
sudo cephadm shell -- rbd pool create test_pool
sudo cephadm shell -- rbd create test_pool/my_image --size 1G
sudo cephadm shell -- rbd ls test_pool
```

тЬЕ ржпржжрж┐ `HEALTH_OK` ржжрзЗржЦрж╛ржпрж╝, рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛рж░ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржирзЛржб Ceph ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж░рзЗржбрж┐!

---

## ЁЯМР ржзрж╛ржк рзн: Ceph Dashboard ржПржХрзНрж╕рзЗрж╕ (ржРржЪрзНржЫрж┐ржХ)

Cephadm ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ Dashboard ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗред ржПржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ:

```bash
# Dashboard-ржПрж░ admin ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрзЗржЦрзБржи
sudo cephadm shell -- ceph dashboard get-login-credentials
```

ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржпрж╛ржи: `https://192.168.68.180:8443`
> тЪая╕П рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржУржпрж╝рж╛рж░рзНржирж┐ржВ ржЖрж╕рж▓рзЗ "Proceed/Advanced" ржП ржХрзНрж▓рж┐ржХ ржХрж░рзБржи (Self-signed certificate)ред

---

## ЁЯЫая╕П ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржУ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЯрж┐ржкрж╕

### тЭУ Docker vs Podman
Cephadm ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ Podman ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржЖржкржирж┐ ржпржжрж┐ ржнрзБрж▓ ржХрж░рзЗ `--container-engine docker` ржлрзНрж▓рзНржпрж╛ржЧ ржирж╛ ржжрзЗржи, рждрж╛рж╣рж▓рзЗ ржПржЯрж┐ Podman ржЗржирзНрж╕ржЯрж▓ ржХрж░рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░ржмрзЗред рж╕ржмрж╕ржоржпрж╝ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ рж╕ржоржпрж╝ ржПржХрзНрж╕ржкрзНрж▓рж┐рж╕рж┐ржЯрж▓рж┐ Docker ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рзБржиред

### тЭУ `/dev/sdb` Available ржжрзЗржЦрж╛ржЪрзНржЫрзЗ ржирж╛?
ржпржжрж┐ `ceph orch device ls` ржП ржбрж┐рж╕рзНржХржЯрж┐ `No` ржжрзЗржЦрж╛ржпрж╝ ржмрж╛ `Reject reasons` ржерж╛ржХрзЗ:
```bash
# ржбрж┐рж╕рзНржХржЯрж┐ ржЖржЧрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрж┐рж▓ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи
lsblk /dev/sdb

# ржпржжрж┐ ржХрзЛржирзЛ ржкрзБрж░ржирзЛ LVM/Partition ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржЬрзНржпрж╛ржк (zap) ржХрж░рзЗ ржХрзНрж▓рж┐ржи ржХрж░рзБржи
sudo cephadm shell -- ceph orch device zap ceph1 /dev/sdb

# ржПрж░ржкрж░ ржЖржмрж╛рж░ ржЪрзЗржХ ржХрж░рзБржи
sudo cephadm shell -- ceph orch device ls
```

### тЭУ Firewall Issues
Ubuntu-рждрзЗ UFW ржмрж╛ firewall ржЪрж╛рж▓рзБ ржерж╛ржХрж▓рзЗ ржкрзЛрж░рзНржЯ ржУржкрзЗржи ржХрж░рзБржи:
```bash
sudo ufw allow 6789,3300,6800:7300,8443/tcp
sudo ufw allow 6800:7300/udp
```

### тЭУ рж╕рж┐ржЩрзНржЧрзЗрж▓ ржирзЛржбрзЗ ржбрзЗржЯрж╛ рж╕рзЗржлржЯрж┐
`--single-host-defaults` ржлрзНрж▓рзНржпрж╛ржЧ `osd_pool_default_size = 2` рж╕рзЗржЯ ржХрж░рзЗред ржЕрж░рзНржерж╛рзО, ржбрзЗржЯрж╛ рж░рж┐ржкрзНрж▓рж┐ржХрж╛ рждрзИрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп ржХржоржкржХрзНрж╖рзЗ рзиржЯрж┐ OSD ржкрзНрж░ржпрж╝рзЛржЬржиред ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ ржПржЦржи рззржЯрж┐ OSD (`/dev/sdb`), рждрж╛ржЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ `HEALTH_WARN` ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рзЗ (insufficient number of OSDs)ред ржПржЯрж┐ ржирж░ржорж╛рж▓ред ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржХржоржкржХрзНрж╖рзЗ рзйржЯрж┐ ржирзЛржб/OSD рж░рж┐ржХржорзЗржирзНржбрзЗржбред

---

## ЁЯУЭ ржХрзБржЗржХ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ рж╢рж┐ржЯ

```bash
# ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕
cephadm shell -- ceph -s

# ржирждрзБржи OSD ржЕрзНржпрж╛ржб (ржЖрж░рзЗржХржЯрж┐ ржбрж┐рж╕рзНржХ /dev/sdc ржерж╛ржХрж▓рзЗ)
cephadm shell -- ceph orch daemon add osd ceph1:/dev/sdc

# рж╕ржХрж▓ Available ржбрж┐рж╕рзНржХ ржЕржЯрзЛ-ржЕрзНржпрж╛ржб ржХрж░рзБржи (рж╕рждрж░рзНржХрждрж╛: рж╕ржм ржЦрж╛рж▓рж┐ ржбрж┐рж╕рзНржХ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ!)
cephadm shell -- ceph orch apply osd --all-available-devices

# ржбрж┐ржоржи рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ
cephadm shell -- ceph orch restart osd

# рж▓ржЧ ржЪрзЗржХ
cephadm shell -- ceph orch logs osd.0
```

---

## ЁЯз╣ Ceph ржХрзНрж▓рж┐ржиржЖржк (Uninstall & Remove)

> тЪая╕П **рж╕рждрж░рзНржХрждрж╛:** ржПржЗ ржзрж╛ржкржЧрзБрж▓рзЛ ржЖржкржирж╛рж░ рж╕ржм Ceph ржбрзЗржЯрж╛, ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи, ржкрзБрж▓, OSD ржПржмржВ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржорзБржЫрзЗ ржлрзЗрж▓ржмрзЗред ржкрзНрж░ржбрж╛ржХрж╢ржирзЗ рж░рж╛ржи ржХрж░рж╛рж░ ржЖржЧрзЗ ржирж┐рж╢рзНржЪрж┐ржд рж╣рзЛржи ржмрзНржпрж╛ржХржЖржк ржирзЗржУржпрж╝рж╛ ржЖржЫрзЗред

### ржзрж╛ржк рзз: ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ FSID ржирзЛржЯ ржХрж░рж╛ ржУ рж░рж┐ржорзБржн

ржкрзНрж░ржержорзЗ рж░рж╛ржирж┐ржВ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржЖржЗржбрж┐ (FSID) ржмрзЗрж░ ржХрж░рзЗ рж╕рзЗржЯрж┐ рж░рж┐ржорзБржн ржХрж░рждрзЗ рж╣ржмрзЗред

#### рзз. рж░рж╛ржирж┐ржВ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ рждрж╛рж▓рж┐ржХрж╛ ржУ FSID ржЪрзЗржХ ржХрж░рзБржи
```
sudo cephadm ls
```
#### ржЖржЙржЯржкрзБржЯ ржерзЗржХрзЗ ржЖржкржирж╛рж░ FSID ржЯрж┐ ржХржкрж┐ ржХрж░рзБржи (ржЙржжрж╛рж╣рж░ржг: 438ec756-12f7-11f1-89d6-bc241192dd00)

#### рзи. ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ржЯрж┐ ржЬрзЛрж░ржкрзВрж░рзНржмржХ рж░рж┐ржорзБржн ржХрж░рзБржи (--force ржлрзНрж▓рзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ)
#### ржирзЛржЯ: <YOUR-FSID> ржПрж░ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ ржЖржкржирж╛рж░ ржЖрж╕рж▓ FSID ржЯрж┐ ржмрж╕рж╛ржи
```
sudo cephadm rm-cluster --fsid <YOUR-FSID> --force
```

### ржзрж╛ржк рзи: ржХржирзНржЯрзЗржЗржирж╛рж░ ржУ ржнрж▓рж┐ржЙржо ржХрзНрж▓рж┐ржиржЖржк (Docker/Podman)

#### Ceph ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬржб рж╣ржУржпрж╝рж╛ржпрж╝ ржбржХрж╛рж░ ржмрж╛ ржкржбржорзНржпрж╛ржирзЗрж░ ржЕржмрж╢рж┐рж╖рзНржЯ ржлрж╛ржЗрж▓ ржорзБржЫрждрзЗ рж╣ржмрзЗред ржЖржкржирж┐ ржХрзЛржи рж░рж╛ржиржЯрж╛ржЗржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗржи рждрж╛ ржЪрзЗржХ ржХрж░рзЗ рж╕ржВрж╢рзНрж▓рж┐рж╖рзНржЯ ржХржорж╛ржирзНржб ржжрж┐ржиред

#### ржпржжрж┐ Docker ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи:

# рж╕ржм Ceph ржХржирзНржЯрзЗржЗржирж╛рж░ ржмржирзНржз ржХрж░рзЗ рж░рж┐ржорзБржн
```
sudo docker rm -f $(sudo docker ps -aq --filter name=ceph-) 2>/dev/null
```
#### ржЕржмрзНржпржмрж╣рзГржд ржнрж▓рж┐ржЙржо, ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржПржмржВ ржЗржорзЗржЬ ржХрзНрж▓рж┐ржиржЖржк
```
sudo docker volume prune -f
sudo docker network prune -f
sudo docker image prune -a -f
sudo docker system prune -a -f --volumes
```
### ржпржжрж┐ Podman ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи (Cephadm ржбрж┐ржлрж▓рзНржЯ):

#### рж╕ржм Ceph ржХржирзНржЯрзЗржЗржирж╛рж░ ржмржирзНржз ржХрж░рзЗ рж░рж┐ржорзБржн
```
sudo podman rm -f $(sudo podman ps -aq --filter name=ceph-) 2>/dev/null
sudo podman volume prune -f
sudo podman network prune -f
sudo podman image prune -a -f
```

### ржзрж╛ржк рзй: APT ржкрзНржпрж╛ржХрзЗржЬ ржЖржиржЗржирж╕рзНржЯрж▓

#### cephadm ржУ ceph-common рж░рж┐ржорзБржн
рж╕рж┐рж╕рзНржЯрзЗржо ржерзЗржХрзЗ `cephadm` ржПржмржВ рж╕ржорзНржкрж░рзНржХрж┐ржд ржЯрзБрж▓рж╕ рж╕рж░рж┐ржпрж╝рзЗ ржлрзЗрж▓рзБржиред
```bash
sudo apt remove --purge cephadm ceph-common -y
sudo apt autoremove -y
```

#### ржзрж╛ржк рзк: ржлрж╛ржЗрж▓ ржУ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржХрзНрж▓рж┐ржиржЖржк

# ржкрзНрж░ржзрж╛ржи Ceph ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ржЧрзБрж▓рзЛ рж░рж┐ржорзБржн
```
sudo rm -rf /etc/ceph
sudo rm -rf /var/lib/ceph
sudo rm -rf /var/log/ceph
sudo rm -rf /var/cache/ceph
```
### ржпржжрж┐ Rook ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржерж╛ржХрзЗржи рждржмрзЗ рж╕рзЗржЗ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ржУ рж░рж┐ржорзБржн
```
sudo rm -rf /var/lib/rook
```
#### cephadm ржмрж╛ржЗржирж╛рж░рж┐ ржПржмржВ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржлрж╛ржЗрж▓ ржорзБржЫрзЗ ржлрзЗрж▓рж╛ (ржмрж┐ржнрж┐ржирзНржи рж▓рзЛржХрзЗрж╢ржи ржЪрзЗржХ ржХрж░рзЗ)
```
sudo rm -f /usr/sbin/cephadm
sudo rm -f /usr/local/bin/cephadm
sudo rm -f ./cephadm  # ржмрж░рзНрждржорж╛ржи ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ ржерж╛ржХрж▓рзЗ
```
#### APT рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржПржмржВ GPG ржХрж┐ рж░рж┐ржорзБржн
```
sudo rm -f /etc/apt/sources.list.d/ceph.list
sudo rm -f /usr/share/keyrings/ceph-archive-keyring.gpg
```
#### рж░рзБржЯ ржЗржЙржЬрж╛рж░рзЗрж░ SSH authorized_keys ржерзЗржХрзЗ Ceph ржХрж┐ ржПржирзНржЯрзНрж░рж┐ ржорзБржЫрзЗ ржлрзЗрж▓рж╛ (ржпржжрж┐ ржерж╛ржХрзЗ)

```
sudo sed -i '/ceph-public/d' /root/.ssh/authorized_keys 2>/dev/null
sudo sed -i '/ceph-admin/d' /root/.ssh/authorized_keys 2>/dev/null
```

#### ржзрж╛ржк рзл: рж╕рж┐рж╕рзНржЯрзЗржо рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ (Optional but Recommended)
```bash
sudo reboot
```
#### рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯрзЗрж░ ржкрж░ ржпрж╛ржЪрж╛ржЗржХрж░ржг (Verification): 
> рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ ржжрж┐ржпрж╝рзЗ ржирж┐рж╢рзНржЪрж┐ржд рж╣рзЛржи рж╕ржм ржкрж░рж┐рж╖рзНржХрж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ:

#### рзз. ржХржиржлрж┐ржЧ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржЪрзЗржХ (No such file or directory ржЖрж╕рж╛ ржЙржЪрж┐ржд)
```
ls /etc/ceph
```
#### рзи. cephadm ржХржорж╛ржирзНржб ржЪрзЗржХ (Command not found ржЖрж╕рж╛ ржЙржЪрж┐ржд)
```
cephadm --version
```
#### рзй. рж░рж╛ржирж┐ржВ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЪрзЗржХ (ржХрзЛржирзЛ ceph ржХржирзНржЯрзЗржЗржирж╛рж░ ржерж╛ржХрж╛рж░ ржХржерж╛ ржиржпрж╝)
```
sudo docker ps -a | grep ceph
```
ржПржЦржи рж╕рж┐рж╕рзНржЯрзЗржо ржерзЗржХрзЗ Ceph (Uninstall & Remove) рж╣рзЯрзЗржЫрзЗред


---

## ЁЯЫая╕П ржЕрждрж┐рж░рж┐ржХрзНржд ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржУ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЯрж┐ржкрж╕

```
Ceph Cluster Bootstrap ржХрж░рж╛рж░ рж╕ржорзЯржГ
рззред  "--single-host-defaults" ржлрзНрж▓рзНржпрж╛ржЧ ржХрзЗржирзЛ ржжрж┐рждрзЗ рж╣рзЯ? ржирж╛ ржжрж┐рж▓рзЗ ржХрж┐ рж╣ржмрзЗ? ржЖрж░ ржжрж┐рж▓рзЗ ржХрж┐ рж╣ржмрзЗ? ржпржЦржи ржорж╛рж▓рзНржЯрж┐ржирзЛржбрзЗ Ceph Cluster Bootstrap ржХрж░ржмрзЛ рждржЦржиржУ ржХрж┐ "--single-host-defaults" ржлрзНрж▓рзНржпрж╛ржЧ ржжрж┐рждрзЗ рж╣ржмрзЗ? 
рзиред Ceph Cluster Bootstrap ржХрж░рж╛рж░ ржЖржЧрзЗржЗ рждрзЛ ржирзЛржбрзЗ Docker install ржХрж░рзЗржЫрж┐, рждрж╛рж╣рж▓рзЗ Ceph Cluster Bootstrap ржХрж░рж╛рж░ рж╕ржорзЯ ржХрзЗржирзЛ ржЖржмрж╛рж░  "--container-engine docker" ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗ ? ржЖржорж╛ржХрзЗ ржмрзБржЭрж┐рзЯрзЗ ржмрж▓рзБржиред

```

# ЁЯОп Cephadm Bootstrap Flags - ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛

ржЖржкржирж╛рж░ ржжрзБржЯрж┐ ржкрзНрж░рж╢рзНржиржЗ ржЦрзБржмржЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржПржмржВ ржХржирж╕рзЗржкржЪрзБржпрж╝рж╛рж▓ред ржЪрж▓рзБржи ржкрзНрж░рждрж┐ржЯрж┐ ржмрж┐рж╖ржпрж╝ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржУ ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржЙржжрж╛рж╣рж░ржг рж╕рж╣ ржмрзБржЭрзЗ ржирзЗржЗред

---

## тЭУ ржкрзНрж░рж╢рзНржи рзз: `--single-host-defaults` ржлрзНрж▓рзНржпрж╛ржЧ ржХрзЗржирзЛ ржжрж┐рждрзЗ рж╣ржпрж╝?

### ЁЯФ╣ ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧржЯрж┐ ржХрзА ржХрж░рзЗ?

ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧржЯрж┐ Ceph-ржХрзЗ ржмрж▓рзЗ: *"ржнрж╛ржЗ, ржЖржорж┐ рж╢рзБржзрзБ ржПржХржЯрж┐ ржирзЛржбрзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржЪрж╛рж▓рж╛ржЪрзНржЫрж┐, рждрж╛ржЗ ржкрзНрж▓рж┐ржЬ рждрзЛржорж╛рж░ ржбрж┐ржлрж▓рзНржЯ рж╕рзЗржЯрж┐ржВрж╕ржЧрзБрж▓рзЛ ржЖржорж╛рж░ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржирзЛржб ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ ржЕржирзБржпрж╛ржпрж╝рзА ржЕрзНржпрж╛ржбржЬрж╛рж╕рзНржЯ ржХрж░рзЗ ржжрж╛ржУред"*

### ЁЯФ╣ ржЯрзЗржХржирж┐ржХрзНржпрж╛рж▓рж┐ ржПржЯрж┐ ржХрзА ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ?

| ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи | ржбрж┐ржлрж▓рзНржЯ (Multi-Node) | `--single-host-defaults` рж╕рж╣ |
|------------|-------------------|---------------------------|
| `osd_pool_default_size` | 3 (рзйржЯрж┐ рж░рзЗржкрзНрж▓рж┐ржХрж╛) | 2 (рзиржЯрж┐ рж░рзЗржкрзНрж▓рж┐ржХрж╛ - ржорж┐ржирж┐ржорж╛ржо) |
| `osd_pool_default_min_size` | 2 | 1 |
| `mon_allow_pool_size_one` | false | true |
| CRUSH Failure Domain | `host` | `host` (ржХрж┐ржирзНрждрзБ single-host aware) |
| PG Autoscaling | Standard | Conservative for single node |

### ЁЯФ╣ ржирж╛ ржжрж┐рж▓рзЗ ржХрзА рж╣ржмрзЗ? (Without Flag)

```bash
# ржЙржжрж╛рж╣рж░ржг: ржлрзНрж▓рзНржпрж╛ржЧ ржЫрж╛ржбрж╝рж╛ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк
sudo cephadm bootstrap --mon-ip 192.168.68.180
```

**ржлрж▓рж╛ржлрж▓:**
```
тЬЕ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк рж╕ржлрж▓ рж╣ржмрзЗ
тЪая╕П ржХрж┐ржирзНрждрзБ HEALTH_WARN ржжрзЗржЦрж╛ржмрзЗ:
   "pool 'rbd' has 1 pg(s) not deploying: not enough OSDs"
   "too few OSDs to create pool replicas"
```

**ржХрзЗржирзЛ?**
- Ceph ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ рзйржЯрж┐ рж░рзЗржкрзНрж▓рж┐ржХрж╛ ржЪрж╛ржпрж╝ (`size=3`)
- ржХрж┐ржирзНрждрзБ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржорж╛рждрзНрж░ рззржЯрж┐ OSD (`/dev/sdb`)
- рждрж╛ржЗ ржбрзЗржЯрж╛ рж░рж╛ржЗржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ тЖТ `HEALTH_WARN`

### ЁЯФ╣ ржжрж┐рж▓рзЗ ржХрзА рж╣ржмрзЗ? (With Flag)

```bash
# рж╕рж┐ржЩрзНржЧрзЗрж▓-ржирзЛржб ржлрзНрж▓рзНржпрж╛ржЧ рж╕рж╣
sudo cephadm bootstrap --mon-ip 192.168.68.180 --single-host-defaults
```

**ржлрж▓рж╛ржлрж▓:**
```
тЬЕ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк рж╕ржлрж▓
тЬЕ HEALTH_OK (ржЕржержмрж╛ рж╕рж╛ржоржпрж╝рж┐ржХ HEALTH_WARN ржпрзЗржЯрж╛ ржкрж░рзЗ ржарж┐ржХ рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ)
тЬЕ рзиржЯрж┐ рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯ рж╣ржмрзЗ, ржпрж╛ рззржЯрж┐ ржирзЛржбрзЗржУ ржХрж╛ржЬ ржХрж░ржмрзЗ
тЬЕ CRUSH ржорзНржпрж╛ржк рж╕рж┐ржЩрзНржЧрзЗрж▓-рж╣рзЛрж╕рзНржЯрзЗрж░ ржЬржирзНржп ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб рж╣ржмрзЗ
```

### ЁЯФ╣ ржорж╛рж▓рзНржЯрж┐-ржирзЛржбрзЗ ржХрж┐ ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧ ржжрзЗржмрзЛ?

> тЭМ **ржирж╛, ржорж╛рж▓рзНржЯрж┐-ржирзЛржбрзЗ ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧ ржжрзЗржмрзЗржи ржирж╛!**

**ржХрзЗржирзЛ?**

| рж╕рж┐ржирж╛рж░рж┐ржУ | рж░рж┐ржХржорзЗржирзНржбрзЗрж╢ржи | ржХрж╛рж░ржг |
|---------|------------|-------|
| **Single Node (Lab/Dev)** | тЬЕ `--single-host-defaults` ржжрж┐ржи | рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯрж┐ржВрж╕ рж░рж┐рж▓рзНржпрж╛ржХрзНрж╕ ржХрж░рзЗ, рззржЯрж┐ ржирзЛржбрзЗржУ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржЪрж╛рж▓рзБ рж░рж╛ржЦрзЗ |
| **Multi-Node (Production)** | тЭМ ржлрзНрж▓рзНржпрж╛ржЧ ржжрзЗржмрзЗржи ржирж╛ | Ceph ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ ржбрзЗржЯрж╛ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙржЯ ржХрж░ржмрзЗ ржмрж┐ржнрж┐ржирзНржи рж╣рзЛрж╕рзНржЯрзЗ, рзйржЯрж┐ рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржлржЯрж┐ ржжрзЗржмрзЗ |
| **Multi-Node ржХрж┐ржирзНрждрзБ ржХржо OSD** | тЪая╕П ржХрж╛рж╕рзНржЯржо ржкрзБрж▓ рж╕рзЗржЯрж┐ржВрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи | `ceph osd pool set <pool> size 2` ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ рж╕рзЗржЯ ржХрж░рзБржи |

### ЁЯФ╣ ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржбрзЗржорзЛ: ржлрзНрж▓рзНржпрж╛ржЧрзЗрж░ ржкрзНрж░ржнрж╛ржм ржЪрзЗржХ ржХрж░рж╛

```bash
# ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ ржкрж░ ржПржЗ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ рж░рж╛ржи ржХрж░рзЗ ржжрзЗржЦрзБржи ржкрж╛рж░рзНржержХрзНржп:

# рзз. ржкрзБрж▓рзЗрж░ рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯрж┐ржВрж╕ ржЪрзЗржХ
sudo cephadm shell -- ceph osd pool get rbd size

# Without flag: size: 3
# With --single-host-defaults: size: 2

# рзи. CRUSH рж░рзБрж▓ ржЪрзЗржХ
sudo cephadm shell -- ceph osd crush rule dump replicated_rule

# рж▓ржХрзНрж╖рзНржп ржХрж░рзБржи: failure_domain = host, ржХрж┐ржирзНрждрзБ single-host ржорзЛржбрзЗ 
# ржПржХржЗ рж╣рзЛрж╕рзНржЯрзЗ ржПржХрж╛ржзрж┐ржХ OSD ржерж╛ржХрж▓рзЗржУ рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж░рж╛ржЦрждрзЗ ржжрзЗржмрзЗ
```

---

## тЭУ ржкрзНрж░рж╢рзНржи рзи: Docker ржЖржЧрзЗржЗ ржЗржирзНрж╕ржЯрж▓, рждржмрзБ `--container-engine docker` ржХрзЗржирзЛ?

### ЁЯФ╣ рж╕рж╣ржЬ ржЙрждрзНрждрж░:
> **Docker ржЗржирзНрж╕ржЯрж▓ ржерж╛ржХрж▓рзЗржЗ Cephadm ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ Docker ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ ржирж╛ред** 
> Cephadm-ржХрзЗ ржПржХрзНрж╕ржкрзНрж▓рж┐рж╕рж┐ржЯрж▓рж┐ ржмрж▓рзЗ ржжрж┐рждрзЗ рж╣ржпрж╝ ржХрзЛржи рж░рж╛ржиржЯрж╛ржЗржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред

### ЁЯФ╣ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржХрж╛рж░ржг:

#### рзз. Cephadm-ржПрж░ ржбрж┐ржлрж▓рзНржЯ ржмрж┐рж╣рзЗржнрж┐ржпрж╝рж╛рж░
Cephadm ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ рж╕ржоржпрж╝ **ржЕржЯрзЛ-ржбрж┐ржЯрзЗржХрж╢ржи** ржХрж░рзЗ:

```
Cephadm Bootstrap Flow:
тФЬтФА Podman installed? тЖТ YES тЖТ Use Podman (DEFAULT)
тФЬтФА Podman not found? тЖТ Check Docker тЖТ Use Docker
тФЬтФА Neither found? тЖТ Install Podman automatically
```

> ЁЯУМ **Ubuntu 24.04-рждрзЗржУ** ржпржжрж┐ ржЖржкржирж┐ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ Podman ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗ ржерж╛ржХрзЗржи (ржЕржержмрж╛ ржХрзЛржирзЛ ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗ ржерж╛ржХрзЗ), рждрж╛рж╣рж▓рзЗ Cephadm Podman-ржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ!

#### рзи. ржлрзНрж▓рзНржпрж╛ржЧ ржирж╛ ржжрж┐рж▓рзЗ ржХрзА рж╕ржорж╕рзНржпрж╛ рж╣рждрзЗ ржкрж╛рж░рзЗ?

```bash
# Scenario: ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗ Docker + Podman ржжрзБржЯрзЛржЗ ржЗржирзНрж╕ржЯрж▓
sudo cephadm bootstrap --mon-ip 192.168.68.180
# (ржлрзНрж▓рзНржпрж╛ржЧ ржЫрж╛ржбрж╝рж╛)

# рж╕ржорзНржнрж╛ржмрзНржп ржлрж▓рж╛ржлрж▓:
тЪая╕П Cephadm Podman ржбрж┐ржлрж▓рзНржЯ рж╣рж┐рж╕рзЗржмрзЗ ржирзЗржмрзЗ
тЪая╕П рж╕ржм Ceph ржХржирзНржЯрзЗржЗржирж╛рж░ Podman ржжрж┐ржпрж╝рзЗ рж░рж╛ржи ржХрж░ржмрзЗ
тЪая╕П ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ Docker-ржПрж░ ржХржорж╛ржирзНржб (`docker ps`, `docker logs`) ржжрж┐ржпрж╝рзЗ ржоржирж┐ржЯрж░ ржХрж░рждрзЗ ржпрж╛ржмрзЗржи тЖТ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛!
тЪая╕П ржнржмрж┐рж╖рзНржпрждрзЗ `ceph orch` ржХржорж╛ржирзНржбржЧрзБрж▓рзЛржУ Podman ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ тЖТ ржХржиржлрж┐ржЙрж╢ржи
```

#### рзй. ржлрзНрж▓рзНржпрж╛ржЧ ржжрж┐рж▓рзЗ ржХрзА рж▓рж╛ржн?

```bash
sudo cephadm bootstrap \
  --mon-ip 192.168.68.180 \
  --container-engine docker  # тЖР ржПржХрзНрж╕ржкрзНрж▓рж┐рж╕рж┐ржЯ ржбрж┐ржХрзНрж▓рж╛рж░рзЗрж╢ржи
```

**рж▓рж╛ржнрж╕ржорзВрж╣:**
| ржмрж┐рж╖ржпрж╝ | ржмрж┐ржмрж░ржг |
|-------|--------|
| тЬЕ **Consistency** | рж╕ржм Ceph ржбрж┐ржоржи, рж╕ржм `ceph orch` ржХржорж╛ржирзНржб Docker-ржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ |
| тЬЕ **Predictability** | ржЖржкржирж┐ ржЬрж╛ржирзЗржи ржХрзЛржерж╛ржпрж╝ ржХржирзНржЯрзЗржЗржирж╛рж░ рж░рж╛ржи ржХрж░ржЫрзЗ: `docker ps` ржжрж┐ржпрж╝рзЗ ржЪрзЗржХ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи |
| тЬЕ **Debugging** | Docker-ржПрж░ рж▓ржЧ, ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ, ржнрж▓рж┐ржЙржо ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржЯрзБрж▓рж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи |
| тЬЕ **Future Commands** | `cephadm adopt`, `cephadm upgrade` - рж╕ржм ржХржорж╛ржирзНржб Docker-ржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ |

### ЁЯФ╣ ржкрзНрж░рзНржпрж╛ржХржЯрж┐ржХрзНржпрж╛рж▓ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи

```bash
# ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ ржкрж░ ржЪрзЗржХ ржХрж░рзБржи ржХрзЛржи ржЗржЮрзНржЬрж┐ржи ржмрзНржпржмрж╣рж╛рж░ рж╣ржЪрзНржЫрзЗ:

# рзз. Ceph ржХржиржлрж┐ржЧ ржЪрзЗржХ
sudo cephadm shell -- ceph config get mgr mgr/cephadm/container_engine

# Output: "docker" ржЕржержмрж╛ "podman"

# рзи. ржХржирзНржЯрзЗржЗржирж╛рж░ рж░рж╛ржиржЯрж╛ржЗржо ржЪрзЗржХ
sudo docker ps | grep ceph    # Docker ржмрзНржпржмрж╣рж╛рж░ рж╣рж▓рзЗ ржЖржЙржЯржкрзБржЯ ржЖрж╕ржмрзЗ
sudo podman ps | grep ceph    # Podman ржмрзНржпржмрж╣рж╛рж░ рж╣рж▓рзЗ ржЖржЙржЯржкрзБржЯ ржЖрж╕ржмрзЗ

# рзй. Cephadm ржХржиржлрж┐ржЧ ржлрж╛ржЗрж▓ ржЪрзЗржХ
cat /etc/ceph/ceph.conf | grep container_engine
```

### ЁЯФ╣ ржорж╛рж▓рзНржЯрж┐-ржирзЛржбрзЗржУ ржХрж┐ ржПржЗ ржлрзНрж▓рзНржпрж╛ржЧ ржжрж┐рждрзЗ рж╣ржмрзЗ?

> тЬЕ **рж╣рзНржпрж╛ржБ, ржпржжрж┐ ржЖржкржирж┐ ржкрзБрж░рзЛ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ Docker ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржиред**

```bash
# Multi-Node Bootstrap (First Node)
sudo cephadm bootstrap \
  --mon-ip 192.168.68.180 \
  --container-engine docker

# ржкрж░ржмрж░рзНрждрзА ржирзЛржбржЧрзБрж▓рзЛ ржЕрзНржпрж╛ржб ржХрж░рж╛рж░ рж╕ржоржпрж╝ржУ Docker ржмрзНржпржмрж╣рж╛рж░ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ:
sudo cephadm add-host --host ceph2.jmc.com --container-engine docker
```

> ЁЯТб **ржЯрж┐ржкрж╕:** ржПржХржмрж╛рж░ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ рж╕ржоржпрж╝ `--container-engine docker` ржжрж┐рж▓рзЗ, Ceph ржПржЗ рж╕рзЗржЯрж┐ржВрж╕ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░-ржУржпрж╝рж╛ржЗржб ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржирзЗ рж╕рзЗржн ржХрж░рзЗ рж░рж╛ржЦрзЗред ржкрж░ржмрж░рзНрждрзАрждрзЗ ржирзЛржб ржЕрзНржпрж╛ржб ржХрж░рж╛рж░ рж╕ржоржпрж╝ ржЖржмрж╛рж░ ржЙрж▓рзНрж▓рзЗржЦ ржирж╛ ржХрж░рж▓рзЗржУ ржПржЯрж┐ Docker-ржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗред рждржмрзЗ ржПржХрзНрж╕ржкрзНрж▓рж┐рж╕рж┐ржЯрж▓рж┐ ржжрзЗржУржпрж╝рж╛ ржнрж╛рж▓рзЛ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ред

---

## ЁЯОп ржХрзБржЗржХ ржбрж┐рж╕рж┐рж╢ржи ржЧрж╛ржЗржб

### `--single-host-defaults` ржХржЦржи ржжрзЗржмрзЗржи?

```
тЬЕ ржжрж┐ржи ржпржЦржи:
   - рж▓рзНржпрж╛ржм/ржЯрзЗрж╕рзНржЯрж┐ржВ ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ
   - ржорж╛рждрзНрж░ рззржЯрж┐ ржлрж┐ржЬрж┐ржХрзНржпрж╛рж▓/VM ржирзЛржб
   - OSD рж╕ржВржЦрзНржпрж╛ рзз-рзиржЯрж┐

тЭМ ржжрзЗржмрзЗржи ржирж╛ ржпржЦржи:
   - ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржорж╛рж▓рзНржЯрж┐-ржирзЛржб ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░
   - рзй+ ржирзЛржб ржПржмржВ рзй+ OSD
   - рж╣рж╛ржЗ-ржПржнрзЗржЗрж▓рзЗржмрж┐рж▓рж┐ржЯрж┐ рж░рж┐ржХрзЛржпрж╝рж╛рж░ржорзЗржирзНржЯ
```

### `--container-engine docker` ржХржЦржи ржжрзЗржмрзЗржи?

```
тЬЕ ржжрж┐ржи ржпржЦржи:
   - ржЖржкржирж┐ Docker-ржПрж░ рж╕рж╛ржерзЗ ржХржоржлрзЛрж░рзНржЯрзЗржмрж▓
   - Docker-ржПрж░ ржЯрзБрж▓рж┐ржВ (`docker logs`, `docker exec`) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржи
   - ржЖржкржирж╛рж░ ржЕрж░рзНржЧрж╛ржирж╛ржЗржЬрзЗрж╢ржирзЗ Docker рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржб

тЬЕ Podman ржбрж┐ржлрж▓рзНржЯ рж░рж╛ржЦрждрзЗ ржЪрж╛ржЗрж▓рзЗ:
   - ржлрзНрж▓рзНржпрж╛ржЧ ржжрзЗржмрзЗржи ржирж╛ (RHEL/CentOS-ржП ржПржЯрж╛ржЗ ржбрж┐ржлрж▓рзНржЯ)
   - ржЕржержмрж╛ ржПржХрзНрж╕ржкрзНрж▓рж┐рж╕рж┐ржЯрж▓рж┐ --container-engine podman ржжрж┐ржи

тЪая╕П ржХржЦржирзЛржЗ ржПржХржЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ ржорж┐ржХрзНрж╕ ржХрж░ржмрзЗржи ржирж╛!
```

---

## ЁЯзк ржмрзЛржирж╛рж╕: ржЖржкржирж╛рж░ ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржлрж╛ржЗржирж╛рж▓ ржХржорж╛ржирзНржб

```bash
# ржЖржкржирж╛рж░ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржирзЛржб + Docker + Ubuntu рж╕рзЗржЯржЖржкрзЗрж░ ржЬржирзНржп ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб:
sudo cephadm bootstrap \
  --mon-ip 192.168.68.180 \
  --single-host-defaults \
  --container-engine docker \
  --dashboard-password-noprompt \
  --allow-overwrite
```

> ЁЯУЭ `--allow-overwrite`: ржпржжрж┐ ржнрзБрж▓ ржХрж░рзЗ ржЖржЧрзЗ ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржк ржХрж░рзЗ ржерж╛ржХрзЗржи ржПржмржВ рж░рж┐-ржЗржирзНрж╕ржЯрж▓ ржХрж░рждрзЗ ржЪрж╛ржиред

---

> ЁЯОп **рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк:**
> 1. `--single-host-defaults` тЖТ рж╕рж┐ржЩрзНржЧрзЗрж▓ ржирзЛржбрзЗ рж░рзЗржкрзНрж▓рж┐ржХрж╛ рж╕рзЗржЯрж┐ржВрж╕ рж░рж┐рж▓рзНржпрж╛ржХрзНрж╕ ржХрж░рзЗ, ржорж╛рж▓рзНржЯрж┐-ржирзЛржбрзЗ ржжрзЗржмрзЗржи ржирж╛
> 2. `--container-engine docker` тЖТ Cephadm-ржХрзЗ ржлрзЛрж░рзНрж╕ ржХрж░рзЗ Docker ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ, ржирж╛ ржжрж┐рж▓рзЗ Podman ржбрж┐ржлрж▓рзНржЯ рж╣рждрзЗ ржкрж╛рж░рзЗ
> 3. ржжрзБржЯрзЛ ржлрзНрж▓рзНржпрж╛ржЧржЗ **ржмрзБржЯрж╕рзНржЯрзНрж░рж╛ржкрзЗрж░ рж╕ржоржпрж╝** ржПржХржмрж╛рж░ржЗ ржжрж┐рждрзЗ рж╣ржпрж╝, ржкрж░рзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░-ржУржпрж╝рж╛ржЗржб рж╕рзЗржн рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝

---

